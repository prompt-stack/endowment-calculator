{# 
  @template templates/index_clean.html
  @type page
  @htmx true
  @alpine true
#}
{% extends "base.html" %}

{% block content %}
<div class="calculator-grid">
        
        <!-- Left Panel: Inputs -->
        <div class="calculator-sidebar">
            <div class="card" x-data="calculator">
                <h2>Endowment Details</h2>
                
                <form id="calculator-form" hx-post="/calculate" hx-target="#results" hx-indicator="#calculating" hx-trigger="input changed delay:500ms, submit">
                    
                    <!-- Starting Balance - Always visible -->
                    <div class="form-group">
                        <label class="form-label">Starting Balance</label>
                        <div class="range-value" x-text="formattedBalance"></div>
                        <input type="range" 
                               name="balance"
                               x-model.number="balance" 
                               min="100000" 
                               max="10000000" 
                               step="50000"
                               class="range-slider">
                        <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--color-gray-500); margin-top: 0.25rem;">
                            <span>$100K</span>
                            <span>$10M</span>
                        </div>
                    </div>
                    
                    <!-- Withdrawal Method - Collapsible -->
                    <div class="form-group accordion-section" x-data="{ open: true }">
                        <div class="accordion-header" @click="open = !open">
                            <label class="form-label">Annual Withdrawal</label>
                            <svg class="accordion-icon" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                        <div class="accordion-content" x-show="open" x-transition>
                        
                        <!-- Live calculation display -->
                        <div style="background: var(--color-gray-50); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.5rem;">
                            <div style="font-size: 0.75rem; color: var(--color-gray-600);">You will withdraw:</div>
                            <div style="font-size: 1rem; font-weight: 600; color: var(--color-gray-900);" x-text="formattedWithdrawal"></div>
                            <div style="font-size: 0.7rem; color: var(--color-gray-500);">(<span x-text="withdrawalRate"></span>% of balance)</div>
                        </div>
                        
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.75rem;">
                            <button type="button"
                                    @click="method = 'percentage'; $el.closest('form').dispatchEvent(new Event('input'))"
                                    :class="method === 'percentage' ? 'btn btn-primary' : 'btn btn-secondary'"
                                    style="flex: 1;">
                                Percentage
                            </button>
                            <button type="button"
                                    @click="method = 'amount'; $el.closest('form').dispatchEvent(new Event('input'))"
                                    :class="method === 'amount' ? 'btn btn-primary' : 'btn btn-secondary'"
                                    style="flex: 1;">
                                Fixed Amount
                            </button>
                        </div>
                        
                        <input type="hidden" name="withdrawal_method" x-bind:value="method">
                        
                        <div x-show="method === 'percentage'">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" 
                                       name="withdrawal_rate"
                                       x-model="rate" 
                                       min="1" 
                                       max="10" 
                                       step="0.5"
                                       class="form-input"
                                       style="width: 80px;">
                                <span>%</span>
                            </div>
                        </div>
                        
                        <div x-show="method === 'amount'">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span>$</span>
                                <input type="text" 
                                       x-model="amountDisplay"
                                       @input="updateAmount($event)"
                                       @focus="$event.target.select()"
                                       class="form-input"
                                       style="width: 120px; text-align: right;">
                                <!-- Hidden input with actual numeric value for form submission -->
                                <input type="hidden" 
                                       name="withdrawal_amount"
                                       x-bind:value="amount">
                            </div>
                            <div style="font-size: 0.75rem; color: var(--color-gray-500); margin-top: 0.25rem;">
                                Min: $10,000 | Max: $500,000
                            </div>
                        </div>
                        </div>
                    </div>
                    
                    <!-- Time Horizon - Collapsible -->
                    <div class="form-group accordion-section" x-data="{ open: false }">
                        <div class="accordion-header" @click="open = !open">
                            <label class="form-label">Time Horizon</label>
                            <svg class="accordion-icon" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                        <div class="accordion-content" x-show="open" x-transition>
                        <div class="radio-group" style="grid-template-columns: 1fr 1fr; gap: 0.25rem;">
                            <label class="radio-option">
                                <input type="radio" name="years" value="10" onchange="this.form.dispatchEvent(new Event('input'))">
                                <span>10 years</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="years" value="20" onchange="this.form.dispatchEvent(new Event('input'))">
                                <span>20 years</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="years" value="50" checked onchange="this.form.dispatchEvent(new Event('input'))">
                                <span>50 years</span>
                            </label>
                            <label class="radio-option" title="Modeled as 100 years for calculation purposes">
                                <input type="radio" name="years" value="100" onchange="this.form.dispatchEvent(new Event('input'))"
                                <span style="display: flex; align-items: center; gap: 0.25rem;">
                                    Perpetuity
                                    <svg style="width: 14px; height: 14px; color: var(--color-gray-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </span>
                            </label>
                        </div>
                        </div>
                    </div>
                    
                    <!-- Investment Strategy Note -->
                    <div class="form-group">
                        <div style="background: var(--color-gray-50); padding: 1rem; border-radius: 8px; border-left: 4px solid var(--color-primary);">
                            <div style="font-size: 0.875rem; color: var(--color-gray-700); line-height: 1.5;">
                                <strong style="color: var(--color-primary);">Comprehensive Analysis:</strong><br>
                                We'll automatically analyze all three investment strategies (Conservative, Balanced, and Aggressive) to provide you with a complete comparison of your options.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Settings - Collapsible -->
                    <div class="form-group accordion-section" x-data="{ open: false }">
                        <div class="accordion-header" @click="open = !open">
                            <label class="form-label">Advanced Settings</label>
                            <svg class="accordion-icon" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                        <div class="accordion-content" x-show="open" x-transition>
                            <label class="form-label" style="font-size: 0.75rem;">Inflation Rate</label>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="number" 
                                       name="inflation" 
                                       value="3" 
                                       min="0" 
                                       max="6" 
                                       step="0.5"
                                       class="form-input"
                                       style="width: 60px; padding: 0.25rem;">
                                <span style="font-size: 0.875rem;">%</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculate Button -->
                    <button type="submit" class="btn btn-primary btn-full">
                        Calculate Sustainability
                        <span id="calculating" class="htmx-indicator" style="margin-left: 0.5rem;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </form>
            </div>
            
            
            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <div class="sidebar-footer-content">
                    <p>Professional Monte Carlo Analysis</p>
                    <p><strong>5,000</strong> simulations for accuracy</p>
                </div>
            </div>
        </div>
        
        <!-- Center/Right Panel: Results -->
        <div class="calculator-results">
            <div id="results">
                <!-- Initial state -->
                <div class="card" style="text-align: center; padding: 3rem;">
                    <div style="max-width: 400px; margin: 0 auto;">
                        <svg style="width: 96px; height: 96px; margin: 0 auto 1.5rem; color: var(--color-gray-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                        <h3 style="font-size: 1.125rem; margin-bottom: 0.5rem;">
                            Ready to Analyze Your Endowment
                        </h3>
                        <p style="color: var(--color-gray-600);">
                            Enter your organization's details to see Monte Carlo projections for sustainable spending
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
{% endblock %}